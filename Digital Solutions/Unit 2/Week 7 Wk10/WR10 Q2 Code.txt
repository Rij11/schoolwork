<?php
include 'header.php';
include 'nav.php';
require 'connect.php';
?>

<article>
    <h1>Find a owner</h1>
    <form name="search" method="post" action="searchowner.php">
        First Name: <input name="firstName" type="text"> <br/><br/>
        Surname: <input name="surname" type="text"> <br/><br/>
        <input name="submit" type="submit" value="Submit"><br/><br/>
    </form><br><br>
</article>
</section>

<?php
     if (isset($_POST['submit'])) {
        $firstName=$_POST['firstName']; //Assign Post
        $surname=$_POST['surname']; //Assign Post
        
        if ($surname == '') {   //If entered only firstName
            $sql = "SELECT o.ownerID, o.firstName, o.surname, o.email, o.street, o.suburb, o.postcode, COUNT(p.petID) AS petCount
                    FROM ownerDetails o
                    JOIN petDetails p ON o.ownerID = p.ownerID
                    WHERE o.firstName = '$firstName'";
        } elseif ($firstName == '') {   //If only entered surname
            $sql = "SELECT o.ownerID, o.firstName, o.surname, o.email, o.street, o.suburb, o.postcode, COUNT(p.petID) AS petCount
                    FROM ownerDetails o
                    JOIN petDetails p ON o.ownerID = p.ownerID
                    WHERE o.surname = '$surname'";
        } else {    //If entered Both Names
            $sql = "SELECT o.ownerID, o.firstName, o.surname, o.email, o.street, o.suburb, o.postcode, COUNT(p.petID) AS petCount
                    FROM ownerDetails o
                    JOIN petDetails p ON o.ownerID = p.ownerID
                    WHERE o.firstName = '$firstName' AND o.surname = '$surname'";
        }
        
        $result = mysqli_query($conn, $sql);
    
        //Display table
        echo "<table border='1'>";
        echo "<tr><th>ID</th><th>First Name</th><th>Surname</th><th>Email</th><th>Street</th><th>Suburb</th><th>Post Code</th><th>Amount of Pets</th></tr>";   //Table titles
        while($row = mysqli_fetch_assoc($result)){
        echo "<tr>
                <td>{$row['ownerID']}</td>
                <td>{$row['firstName']}</td>
                <td>{$row['surname']}</td>
                <td>{$row['email']}</td>
                <td>{$row['street']}</td>
                <td>{$row['suburb']}</td>
                <td>{$row['postcode']}</td>
                <td>{$row['petCount']}</td>
            </tr>";
         }
        echo "</table>";
     }
?>
<?php
include 'footer.php';
?>
</body>
</html>